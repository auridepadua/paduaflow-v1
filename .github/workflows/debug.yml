name: Garmin Auth Test

on:
  workflow_dispatch:

jobs:
  auth-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Create token directory
        run: mkdir -p /home/runner/.garminconnect

      - name: Decode and write oauth1_token.json
        run: |
          echo "${{ secrets.OAUTH1_TOKEN_B64 }}" | base64 -d > /home/runner/.garminconnect/oauth1_token.json

      - name: Decode and write oauth2_token.json
        run: |
          echo "${{ secrets.OAUTH2_TOKEN_B64 }}" | base64 -d > /home/runner/.garminconnect/oauth2_token.json

      - name: Install dependencies
        run: pip install -r requirements-test.txt

      - name: Test Garmin authentication
        run: |
          python3 -c "
import os
from garminconnect import (
    Garmin,
)

client = Garmin()
client.login(tokenstore='/home/runner/.garminconnect')
print('âœ… Garmin authentication successful')
"
